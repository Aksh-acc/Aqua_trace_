{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 60, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/modij/OneDrive/Desktop/coral_bleach_detector/orchids-coral-reef-ai-intelligence-main/src/app/api/sst-data/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\n\r\nconst RAPIDAPI_KEY = process.env.RAPIDAPI_KEY || \"\";\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const { latitude, longitude } = await request.json();\r\n\r\n    if (latitude === undefined || longitude === undefined) {\r\n      return NextResponse.json(\r\n        { error: \"Latitude and longitude are required\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Try to fetch real SST data from RapidAPI\r\n    if (RAPIDAPI_KEY) {\r\n      try {\r\n        const response = await fetch(\r\n          `https://sea-surface-temperature.p.rapidapi.com/current?lat=${latitude}&lon=${longitude}`,\r\n          {\r\n            method: \"GET\",\r\n            headers: {\r\n              \"X-RapidAPI-Key\": RAPIDAPI_KEY,\r\n              \"X-RapidAPI-Host\": \"sea-surface-temperature.p.rapidapi.com\",\r\n            },\r\n          }\r\n        );\r\n\r\n        if (response.ok) {\r\n          const data = await response.json();\r\n          return NextResponse.json({\r\n            location: { lat: latitude, lon: longitude },\r\n            sst_celsius: data.sst || data.temperature || data.sst_celsius,\r\n            dhw: data.dhw || data.degree_heating_weeks || null,\r\n            anomaly: data.anomaly || data.sst_anomaly || null,\r\n            status: data.status || determineStatus(data.sst || data.temperature, data.dhw),\r\n            source: \"rapidapi\",\r\n          });\r\n        }\r\n      } catch (apiError) {\r\n        console.error(\"RapidAPI SST fetch error:\", apiError);\r\n      }\r\n    }\r\n\r\n    // Fallback: Generate realistic simulated SST data based on location\r\n    const simulatedData = generateSimulatedSSTData(latitude, longitude);\r\n    \r\n    return NextResponse.json({\r\n      ...simulatedData,\r\n      source: \"simulated\",\r\n    });\r\n  } catch (error) {\r\n    console.error(\"SST API error:\", error);\r\n    return NextResponse.json(\r\n      { error: \"Failed to fetch SST data\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nfunction determineStatus(sst: number | null, dhw: number | null): string {\r\n  if (!sst) return \"Unknown\";\r\n  \r\n  if (dhw !== null) {\r\n    if (dhw >= 8) return \"Alert Level 2: Severe bleaching likely\";\r\n    if (dhw >= 4) return \"Alert Level 1: Significant bleaching likely\";\r\n    if (dhw >= 1) return \"Watch: Bleaching possible\";\r\n  }\r\n  \r\n  if (sst >= 30) return \"Critical: Extreme thermal stress\";\r\n  if (sst >= 29) return \"Warning: Thermal stress detected\";\r\n  if (sst >= 28) return \"Caution: Elevated temperatures\";\r\n  return \"Normal: Temperature within safe range\";\r\n}\r\n\r\nfunction generateSimulatedSSTData(latitude: number, longitude: number) {\r\n  // Generate realistic SST based on latitude (tropical regions are warmer)\r\n  const absLat = Math.abs(latitude);\r\n  \r\n  // Base temperature varies by latitude\r\n  let baseSst = 28;\r\n  if (absLat < 10) baseSst = 29; // Equatorial\r\n  else if (absLat < 20) baseSst = 28; // Tropical\r\n  else if (absLat < 30) baseSst = 26; // Subtropical\r\n  else baseSst = 24; // Temperate\r\n  \r\n  // Add some randomness\r\n  const sst = baseSst + (Math.random() * 2 - 0.5);\r\n  \r\n  // Calculate DHW (Degree Heating Weeks) based on SST anomaly\r\n  const climatology = baseSst - 1; // Assume climatology is 1°C below current\r\n  const anomaly = sst - climatology;\r\n  const hotspot = Math.max(0, sst - climatology);\r\n  \r\n  // DHW accumulates when hotspot > 1°C\r\n  const dhw = hotspot > 1 ? (hotspot - 1) * 4 + Math.random() * 2 : Math.random() * 1;\r\n  \r\n  return {\r\n    location: { lat: latitude, lon: longitude },\r\n    sst_celsius: Math.round(sst * 10) / 10,\r\n    dhw: Math.round(dhw * 10) / 10,\r\n    anomaly: Math.round(anomaly * 10) / 10,\r\n    hotspot: Math.round(hotspot * 10) / 10,\r\n    status: determineStatus(sst, dhw),\r\n  };\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}